<html>
  <head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <script src="VJS.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.js"></script>
    <link rel="stylesheet" href="style.css" type="text/css">
    <script>
      var socket = io('http://localhost:5000');
      socket.on('connection', function (){
        document.getElementById("status").innerHTML = "Connected";
      });
      function send(){
        xy = document.getElementById("XYvalues").value,
          statusData = document.getElementById("status").value,
          socket = io('http://localhost:5000');
        socket.emit('connection', {transmitterData: xy});
        /*
        Textbox for logging client side joystick values.
        To view textareas : change css, #XYvalues and #status remove "display: none";
        */
        document.getElementById("status").innerHTML = statusData+'\n'+xy;
      }
    </script>
	</head>
	<body>
    <textarea id="XYvalues"></textarea>
    <textarea id="status" readonly="readonly"></textarea>
		<div id="container">
      <canvas width="60" height="60" style="position: absolute; left: 202px; top: 180px; display: none;"></canvas>
      <canvas width="40" height="40" style="position: absolute; left: 223px; top: 200px; display: none;"></canvas>
  		<iframe id="picam" src="http://10.55.168.34:8081/stream.mjpg" onerror="alert('Failed')" frameborder="0">
  			<p>Unable to broadcast.</p>
  		</iframe>
    </div>
		<script>
    var lastCoordinates = document.getElementById('XYvalues').value,
        textarea = document.getElementById('status');
			console.log("touchscreen is", VirtualJoystick.touchScreenAvailable() ? "available" : "not available");
			var joystick	= new VirtualJoystick({
				container: document.getElementById('container'),
				mouseSupport: true,
			});
			setInterval(function(){
				document.getElementById('XYvalues').value = joystick.deltaX()+','+joystick.deltaY()*(-1);
        newCoordinates = document.getElementById('XYvalues').value;
        if (newCoordinates == lastCoordinates){
        } else {
          send();
          lastCoordinates = newCoordinates;
          textarea.scrollTop = textarea.scrollHeight;
        }
      }, 30);
		</script>
  </body>
</html>
